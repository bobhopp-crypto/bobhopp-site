<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bob's Music Video Library</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background-color: #0c0f1c;
      color: #f8f8f8;
      margin: 0;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .filters, .columns {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
      justify-content: center;
    }
    .filters input[type="text"], .filters input[type="number"] {
      padding: 0.4rem;
      border-radius: 4px;
      border: none;
      min-width: 200px;
    }
    .filters button {
      padding: 0.4rem 1rem;
      border: none;
      border-radius: 4px;
      background-color: #28a745;
      color: white;
      cursor: pointer;
    }
    .decade-filter button {
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 4px;
      background-color: #222c3c;
      color: white;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 0.6rem;
      text-align: left;
    }
    th {
      background-color: #1a2138;
      color: #ffeb80;
    }
    tr:nth-child(even) {
      background-color: #141a2b;
    }
    tr:nth-child(odd) {
      background-color: #0f1321;
    }
    img.play-icon {
      height: 20px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <h1>Bob's Music Video Library</h1>
  <div class="filters">
    <input type="text" id="search" placeholder="Search videos..." />
    <input type="number" id="daysFilter" placeholder="Days" min="0" />
    <button onclick="applyFilters()">Filter</button>
  </div>

  <div class="filters decade-filter">
    <button onclick="setDecade('')">All</button>
    <button onclick="setDecade('195')">1950s</button>
    <button onclick="setDecade('196')">1960s</button>
    <button onclick="setDecade('197')">1970s</button>
    <button onclick="setDecade('198')">1980s</button>
    <button onclick="setDecade('199')">1990s</button>
    <button onclick="setDecade('200')">2000s</button>
    <button onclick="setDecade('201')">2010s</button>
    <button onclick="setDecade('202')">2020s</button>
  </div>

  <table id="videoTable">
    <thead>
      <tr>
        <th></th>
        <th>Title</th>
        <th>Artist</th>
        <th>Year</th>
        <th>Genre</th>
        <th>Length</th>
        <th>Play Count</th>
        <th>Days</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let allVideos = [];
    let currentDecade = '';

    fetch("videos/VideoFiles.csv")
      .then(response => response.text())
      .then(data => {
        const rows = data.trim().split("\n");
        const headers = rows[0].split(",");
        allVideos = rows.slice(1).map(row => {
          const values = row.split(",");
          const obj = {};
          headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
          return obj;
        });
        renderTable(allVideos);
      });

    function renderTable(videos) {
      const tbody = document.querySelector("#videoTable tbody");
      tbody.innerHTML = "";
      const today = new Date();

      videos.forEach(video => {
        const row = tbody.insertRow();

        const iconCell = row.insertCell();
        iconCell.innerHTML = \`<a href="\${video["Path"]}" target="_blank">
          <img src="assets/Play Button.png" class="play-icon" alt="â–¶" />
        </a>\`;

        row.insertCell().textContent = video["Title"];
        row.insertCell().textContent = video["Artist"];
        row.insertCell().textContent = video["Year"];
        row.insertCell().textContent = video["Genre"];
        row.insertCell().textContent = video["Length"];
        row.insertCell().textContent = video["Play Count"];

        const daysCell = row.insertCell();
        const firstSeenStr = video["First Seen"];
        let days = "";
        if (firstSeenStr) {
          const firstSeenDate = new Date(firstSeenStr);
          if (!isNaN(firstSeenDate)) {
            const diffTime = today - firstSeenDate;
            days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
          }
        }
        daysCell.textContent = days;
      });
    }

    function applyFilters() {
      const search = document.getElementById("search").value.toLowerCase();
      const daysFilter = parseInt(document.getElementById("daysFilter").value, 10);
      const today = new Date();

      const filtered = allVideos.filter(video => {
        const matchSearch = search === "" ||
          Object.values(video).some(val => val?.toLowerCase().includes(search));
        const matchDecade = currentDecade === "" || video["Year"]?.startsWith(currentDecade);
        const firstSeen = new Date(video["First Seen"]);
        const matchDays = isNaN(daysFilter) || (!isNaN(firstSeen) &&
          ((today - firstSeen) / (1000 * 60 * 60 * 24)) >= daysFilter);
        return matchSearch && matchDecade && matchDays;
      });

      renderTable(filtered);
    }

    function setDecade(prefix) {
      currentDecade = prefix;
      applyFilters();
    }
  </script>
</body>
</html>